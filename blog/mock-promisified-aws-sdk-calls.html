<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title></title><meta name="description"/><meta name="next-head-count" content="4"/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-617444e650969530c471.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" as="script"/><link rel="preload" href="/_next/static/chunks/6d7639b8c21a1db6150380d8b11950c0467e4857.33b3de989fc02f1e1498.js" as="script"/><link rel="preload" href="/_next/static/chunks/e82d01500e11e0131e78851aa17fd9f5e63d6c88.4584f8b587d9150be7f6.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-600fd752c0b787176940.js" as="script"/><link rel="preload" href="/_next/static/chunks/e763d8b2eb2e3ed4e3c29fd9fa38930b1c0c9253.d0a392dc3897215f8dc3.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-5e38c1a1efac4d425dfb.js" as="script"/><style id="__jsx-2073500141">html,body{background-color:#fff;color:#000;}html{font-size:16px;--geist-icons-background:#fff;}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.5;margin:0;padding:0;min-height:100%;position:relative;overflow-x:hidden;font-family:"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;}#__next{overflow-x:hidden;}*,*:before,*:after{box-sizing:inherit;text-rendering:geometricPrecision;-webkit-tap-highlight-color:transparent;}p,small{font-weight:400;color:inherit;-webkit-letter-spacing:-0.005625rem;-moz-letter-spacing:-0.005625rem;-ms-letter-spacing:-0.005625rem;letter-spacing:-0.005625rem;font-family:"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;}p{margin:1rem 0;font-size:1em;line-height:1.625em;}small{margin:0;line-height:1.5;font-size:0.875rem;}b{font-weight:600;}span{font-size:inherit;color:inherit;font-weight:inherit;}img{max-width:100%;}a{cursor:pointer;font-size:inherit;-webkit-touch-callout:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-box-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#0070f3;-webkit-text-decoration:none;text-decoration:none;}a:hover{-webkit-text-decoration:none;text-decoration:none;}ul,ol{padding:0;list-style-type:none;margin:8pt 8pt 8pt 16pt;color:#000;}ol{list-style-type:decimal;}li{margin-bottom:0.625rem;font-size:1em;line-height:1.625em;}ul li:before{content:'â€“';display:inline-block;color:#888;position:absolute;margin-left:-0.9375rem;}h1,h2,h3,h4,h5,h6{color:inherit;margin:0 0 0.625rem 0;}h1{font-size:3rem;-webkit-letter-spacing:-0.066875rem;-moz-letter-spacing:-0.066875rem;-ms-letter-spacing:-0.066875rem;letter-spacing:-0.066875rem;line-height:1.5;font-weight:700;}h2{font-size:2.25rem;-webkit-letter-spacing:-0.020625rem;-moz-letter-spacing:-0.020625rem;-ms-letter-spacing:-0.020625rem;letter-spacing:-0.020625rem;font-weight:600;}h3{font-size:1.5rem;-webkit-letter-spacing:-0.029375rem;-moz-letter-spacing:-0.029375rem;-ms-letter-spacing:-0.029375rem;letter-spacing:-0.029375rem;font-weight:600;}h4{font-size:1.25rem;-webkit-letter-spacing:-0.020625rem;-moz-letter-spacing:-0.020625rem;-ms-letter-spacing:-0.020625rem;letter-spacing:-0.020625rem;font-weight:600;}h5{font-size:1rem;-webkit-letter-spacing:-0.01125rem;-moz-letter-spacing:-0.01125rem;-ms-letter-spacing:-0.01125rem;letter-spacing:-0.01125rem;font-weight:600;}h6{font-size:0.875rem;-webkit-letter-spacing:-0.005625rem;-moz-letter-spacing:-0.005625rem;-ms-letter-spacing:-0.005625rem;letter-spacing:-0.005625rem;font-weight:600;}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit;color:inherit;margin:0;}button:focus,input:focus,select:focus,textarea:focus{outline:none;}code{color:#f81ce5;font-family:Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;font-size:0.9em;white-space:pre-wrap;}code:before,code:after{content:'\`';}pre{border:1px solid #eaeaea;border-radius:5px;padding:calc(16pt * 0.75) 16pt;margin:16pt 0;font-family:Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;white-space:pre;overflow:auto;line-height:1.5;text-align:left;font-size:0.875rem;-webkit-overflow-scrolling:touch;}pre code{color:#000;font-size:0.8125rem;line-height:1.25rem;white-space:pre;}pre code:before,pre code:after{display:none;}pre p{margin:0;}pre::-webkit-scrollbar{display:none;width:0;height:0;background:transparent;}hr{border-color:#eaeaea;}details{background-color:#fafafa;border:none;}details:focus,details:hover,details:active{outline:none;}summary{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;list-style:none;outline:none;}summary::-webkit-details-marker,summary::before{display:none;}summary::-moz-list-bullet{font-size:0;}summary:focus,summary:hover,summary:active{outline:none;list-style:none;}blockquote{padding:calc(0.667 * 16pt) 16pt;color:#666;background-color:#fafafa;border-radius:5px;margin:1.5rem 0;border:1px solid #eaeaea;}blockquote *:first-child{margin-top:0;}blockquote *:last-child{margin-bottom:0;}::selection{background-color:#79ffe1;color:#000;}</style><style id="__jsx-3101351360">.link.jsx-3101351360{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;line-height:inherit;color:inherit;-webkit-text-decoration:none;text-decoration:none;padding:calc(0 * 0.8) calc(0 * 1.7);border-radius:0;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;-webkit-transition:color 200ms ease 0ms;transition:color 200ms ease 0ms;}.link.jsx-3101351360:hover,.link.jsx-3101351360:active,.link.jsx-3101351360:focus{-webkit-text-decoration:none;text-decoration:none;}.link.jsx-3101351360:hover{background-color:unset;color:inherit;}</style><style id="__jsx-1078679289">.btn.jsx-1078679289{box-sizing:border-box;display:inline-block;padding:0 1.25rem;height:2.5rem;line-height:2.5rem;min-width:min-content;width:auto;border-radius:5px;font-weight:400;font-size:.875rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;outline:none;text-transform:capitalize;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;text-align:center;white-space:nowrap;-webkit-transition:background-color 200ms ease 0ms,box-shadow 200ms ease 0ms, border 200ms ease 0ms,color 200ms ease 0ms;transition:background-color 200ms ease 0ms,box-shadow 200ms ease 0ms, border 200ms ease 0ms,color 200ms ease 0ms;position:relative;overflow:hidden;color:#666;background-color:transparent;border:1px solid transparent;cursor:pointer;pointer-events:auto;box-shadow:none;--geist-ui-button-padding:1.25rem;--geist-ui-button-height:2.5rem;--geist-ui-button-color:#666;--geist-ui-button-bg:transparent;}.btn.jsx-1078679289:hover,.btn.jsx-1078679289:focus{color:#666;--geist-ui-button-color:#666;background-color:transparent;border-color:transparent;cursor:pointer;pointer-events:auto;box-shadow:none;-webkit-transform:translate3d(0px,0px,0px);-ms-transform:translate3d(0px,0px,0px);transform:translate3d(0px,0px,0px);}.btn.jsx-1078679289 .text{position:relative;z-index:1;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;text-align:center;line-height:inherit;top:-1px;}.btn.jsx-1078679289 .text p,.btn.jsx-1078679289 .text pre,.btn.jsx-1078679289 .text div{margin:0;}</style><style id="__jsx-1583513589">.tabs.jsx-1583513589{width:initial;}header.jsx-1583513589{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid #eaeaea;overflow:scroll;-webkit-scrollbar-width:none;-moz-scrollbar-width:none;-ms-scrollbar-width:none;scrollbar-width:none;}header.jsx-1583513589::-webkit-scrollbar{display:none;}.hide-divider.jsx-1583513589{border-bottom:none;}.content.jsx-1583513589{padding-top:0.625rem;}.tab.jsx-1583513589{padding:4pt calc(0.65 * 4pt);cursor:pointer;outline:0;-webkit-transition:all 200ms ease;transition:all 200ms ease;text-transform:capitalize;font-size:1rem;white-space:nowrap;margin:0 calc(0.8 * 8pt);color:#444;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;line-height:1.25rem;position:relative;}.tab.jsx-1583513589:after{position:absolute;content:'';bottom:-1px;left:0;right:0;width:100%;height:2px;-webkit-transform:scaleX(0.75);-ms-transform:scaleX(0.75);transform:scaleX(0.75);background-color:transparent;-webkit-transition:all 200ms ease;transition:all 200ms ease;}.tab.active.jsx-1583513589:after{background-color:#000;-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);}.tab.jsx-1583513589 svg{max-height:1em;margin-right:5px;}.tab.jsx-1583513589:first-of-type{margin-left:0;}.tab.active.jsx-1583513589{color:#000;}.tab.disabled.jsx-1583513589{color:#999;cursor:not-allowed;}</style><style id="__jsx-225541363">span.jsx-225541363{display:inline-block;height:1px;width:1px;margin-left:calc(15.25pt + 1px * 0);margin-top:calc(15.25pt + 1px * 0);}</style><style id="__jsx-180329529">.col.jsx-180329529{float:left;box-sizing:border-box;padding-left:calc(var(--row-gap) / 2);padding-right:calc(var(--row-gap) / 2);width:100%;margin-left:0%;}</style><style id="__jsx-870436695">span.jsx-870436695{display:block;height:1px;width:1px;margin-left:calc(15.25pt + 1px * 0);margin-top:calc(15.25pt + 1px * 0);}</style><style id="__jsx-2751559520">.row.jsx-2751559520{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;box-sizing:border-box;margin-left:calc(0 * 16pt / 2);margin-right:calc(0 * 16pt / 2);--row-gap:calc(0 * 16pt);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:normal;-webkit-box-align:normal;-ms-flex-align:normal;align-items:normal;}</style><style id="__jsx-1520861353">footer.jsx-1520861353{width:calc(100% - 16pt * 2);position:absolute;bottom:0;}</style><style id="__jsx-3691154343">main.jsx-3691154343{width:100%;padding:calc(16pt * 2.5) 0;}</style><style id="__jsx-3167743014">body{background-image:radial-gradient(#e3e3e3 1px,transparent 0), radial-gradient(#e3e3e3 1px,transparent 0);background-position:0 0,25px 25px;background-attachment:fixed;background-size:50px 50px;}</style><style id="__jsx-931126289">section.jsx-931126289{width:750pt;max-width:100vw;min-height:100vh;margin:0 auto;padding:0 16pt;box-sizing:border-box;position:relative;}</style></head><body><div id="__next"><div class="c221"><div class="c222"><a href="/" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="16" width="16" style="color:currentColor"><path d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8zM6 1v3M10 1v3M14 1v3"></path></svg><div style="display:flex"><div class="c223">Costinha</div></div></a><div class="c227"><button type="button" aria-label="Toggle Dark mode" class="jsx-1078679289 btn c228"><div class="text"><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="16" width="16" style="color:currentColor"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg></div></button></div></div></div><nav class="c224 "><div class="c226"><div class="jsx-1583513589 tabs "><header class="jsx-1583513589 "></header><div class="jsx-1583513589 content"></div></div></div></nav><main><section class="jsx-931126289 "><main class="jsx-3691154343 "><article><h3>Mock promisified AWS service operation calls with Jest</h3><p>At <a href="https://mbanq.com/cloud">Mbanq Cloud</a> we run most of our services on AWS and try to use AWS Lambda as much as possible.</p><p>A while ago Iâ€™ve been working on the a small npm package that should have helped us to make use of SSM and <a href="https://aws.amazon.com/kms/">KMS</a> to manage our system configuration. SSM and KMS play nicely together as the most of the AWS services.</p><p>In order to test the newly written npm package, I had to mock the promisified version of the <code>ssm.getParameters(request)</code></p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#f8c555">AWS</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">require</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;aws-sdk&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f8c555">AWS</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f8c555">SSM</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span> region</span><span class="token token" style="color:#67cdcc">:</span><span> &#x27;eu</span><span class="token token" style="color:#67cdcc">-</span><span>west</span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#f08d49">1</span><span> </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span><span>ssm</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">getParameters</span><span class="token token" style="color:#ccc">(</span><span>request</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">promise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#999">// we have to mock the response from this call</span></span></code></pre><p>There are different ways of mocking the AWS JS SDK calls. For example there is the <a href="https://github.com/dwyl/aws-sdk-mock">aws-mock-sdk</a> package from the very cool <a href="https://dwyl.com/">DWYL</a> guys. I decided to go with pure Jest implementation though.</p><p><img src="https://cdn-images-1.medium.com/max/2000/1*yZyG4rhfvTehkTsKtLxD9Q.png" alt=""/></p><p>There are some things to be taken into account to make the SSMâ€™s functionality testable:</p><ul><li>Use <strong>ssm</strong> as a parameter in your function call, e.g. const <code>load = (ssm, keys, expiryMs)</code> It will help you to use the mocked ssm whenever you write your tests. Sure you could also <code>module.exports = { ssm }</code> alongside other functions you want to export but I didnâ€™t really like this idea</li><li>If you wanna check for the errors thrown inside of an <code>async/await</code> function you have to use: <code>expect(yourFunc()).rejects.toEqual(new Error(&#x27;Error Message&#x27;))</code> . The regular <code>expect(yourFunc()).toThrowError(&#x27;Error Message&#x27;)</code> <a href="https://github.com/facebook/jest/issues/1700#issuecomment-377890222">**WONâ€™T WORK</a>**</li></ul><p>Ok, now youâ€™re probably asking yourself:</p><blockquote><p>How the heck do you mock the promisified AWS service operation calls?</p></blockquote><p>You will either want to mock a successful response from the <code>ssm.getParameters(request).promise()</code> or the <code>Error</code> thrown by the this function call.</p><h3>Successful response</h3><p>First, create a js object with the promise key and mock the value of the promise with the <code>jest.fn().mockImplementation()</code> that will return a Promise that when resolved return a successful response.</p><p>Then return the created <code>ssmPromise</code> whenever you make a call to <code>getParameters()</code> function.</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#f8c555">AWS</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">require</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;aws-sdk&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span></span><span class="token token" style="color:#cc99cd">let</span><span> ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">AWS</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f8c555">SSM</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> ssmPromise </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">4</span><span>  promise</span><span class="token token" style="color:#67cdcc">:</span><span> jest</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">fn</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">mockImplementation</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">request</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">5</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Promise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">resolve</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> reject</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">6</span><span>      </span><span class="token token" style="color:#cc99cd">const</span><span> response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">7</span><span>        </span><span class="token token maybe-class-name">Parameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">[</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">8</span><span>          </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">9</span><span>            </span><span class="token token maybe-class-name">Name</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;bar&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">10</span><span>            </span><span class="token token maybe-class-name">Type</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;String&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">11</span><span>            </span><span class="token token maybe-class-name">Value</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;barfoorista&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">12</span><span>            </span><span class="token token maybe-class-name">Version</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">13</span><span>            </span><span class="token token maybe-class-name">LastModifiedDate</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;2018-08-22T13:49:55.717Z&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">14</span><span>            </span><span class="token token" style="color:#f8c555">ARN</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;arn:aws:ssm:eu-west-1:whatever:parameter/bar&#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">15</span><span>          </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">16</span><span>          </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">17</span><span>            </span><span class="token token maybe-class-name">Name</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;foo&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">18</span><span>            </span><span class="token token maybe-class-name">Type</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;String&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">19</span><span>            </span><span class="token token maybe-class-name">Value</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;foobarista&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">20</span><span>            </span><span class="token token maybe-class-name">Version</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">21</span><span>            </span><span class="token token maybe-class-name">LastModifiedDate</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;2018-08-22T13:49:41.486Z&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">22</span><span>            </span><span class="token token" style="color:#f8c555">ARN</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;arn:aws:ssm:eu-west-1:whatever:parameter/foo&#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">23</span><span>           </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">24</span><span>         </span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">25</span><span>         </span><span class="token token maybe-class-name">InvalidParameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">26</span><span>       </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">27</span><span>       </span><span class="token token" style="color:#f08d49">resolve</span><span class="token token" style="color:#ccc">(</span><span>response</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">28</span><span>     </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">29</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">30</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">31</span><span>ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token function-variable" style="color:#f08d49">getParameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> ssmPromise </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#ccc">}</span></span></code></pre><h3>Throw an Error</h3><p>By using the ssm instance you created at the top of your test, you can also mock the <code>ssm.getParameters()</code> in one go.</p><p>Here is an example of how you could mock <code>ssm.getParameters()</code> throwing an Error</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span>ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span>  </span><span class="token token function-variable" style="color:#f08d49">getParameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">4</span><span>      promise</span><span class="token token" style="color:#67cdcc">:</span><span> jest</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">fn</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">mockImplementation</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">request</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">5</span><span>        </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Promise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">resolve</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> reject</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">6</span><span>          </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#f08d49">reject</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;foobar&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">7</span><span>        </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token control-flow" style="color:#cc99cd">catch</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;Ok&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">8</span><span>      </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">9</span><span>    </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">10</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">11</span><span></span><span class="token token" style="color:#ccc">}</span></span></code></pre><p>In a <a href="https://gist.github.com/igorkosta/6dae64ca2ababed7bec95255b2252842#file-sreda-test-js">gist</a> (pun intended) you can see part of the test, weâ€™re using to test our package.</p><p>Here is the content of the <code>gist</code> for you to check out:</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token" style="color:#999">/* eslint-env jest */</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span></span><span class="token token" style="color:#7ec699">&#x27;use strict&#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">4</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span> read</span><span class="token token" style="color:#ccc">,</span><span> keys </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">require</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;../sreda&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">5</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#f8c555">AWS</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">require</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;aws-sdk&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">6</span><span></span><span class="token token" style="color:#cc99cd">let</span><span> ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">AWS</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f8c555">SSM</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">7</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">8</span><span></span><span class="token token" style="color:#cc99cd">var</span><span> ssmPromise </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">9</span><span>  promise</span><span class="token token" style="color:#67cdcc">:</span><span> jest</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">fn</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">mockImplementation</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">request</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">10</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Promise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">resolve</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> reject</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">11</span><span>      </span><span class="token token" style="color:#cc99cd">const</span><span> response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">12</span><span>        </span><span class="token token maybe-class-name">Parameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">[</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">13</span><span>          </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">14</span><span>            </span><span class="token token maybe-class-name">Name</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;bar&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">15</span><span>            </span><span class="token token maybe-class-name">Type</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;String&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">16</span><span>            </span><span class="token token maybe-class-name">Value</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;barfoorista&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">17</span><span>            </span><span class="token token maybe-class-name">Version</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">18</span><span>            </span><span class="token token maybe-class-name">LastModifiedDate</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;2018-08-22T13:49:55.717Z&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">19</span><span>            </span><span class="token token" style="color:#f8c555">ARN</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;arn:aws:ssm:eu-west-1:whatever:parameter/bar&#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">20</span><span>          </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">21</span><span>          </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">22</span><span>            </span><span class="token token maybe-class-name">Name</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;foo&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">23</span><span>            </span><span class="token token maybe-class-name">Type</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;String&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">24</span><span>            </span><span class="token token maybe-class-name">Value</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;foobarista&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">25</span><span>            </span><span class="token token maybe-class-name">Version</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">26</span><span>            </span><span class="token token maybe-class-name">LastModifiedDate</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;2018-08-22T13:49:41.486Z&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">27</span><span>            </span><span class="token token" style="color:#f8c555">ARN</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;arn:aws:ssm:eu-west-1:whatever:parameter/foo&#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">28</span><span>          </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">29</span><span>        </span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">30</span><span>        </span><span class="token token maybe-class-name">InvalidParameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">31</span><span>      </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">32</span><span>      </span><span class="token token" style="color:#f08d49">resolve</span><span class="token token" style="color:#ccc">(</span><span>response</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">33</span><span>    </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">34</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">35</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">36</span><span>ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token function-variable" style="color:#f08d49">getParameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> ssmPromise </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">37</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">38</span><span></span><span class="token token" style="color:#f08d49">describe</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;mock AWS.SSM()&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">39</span><span>  </span><span class="token token" style="color:#f08d49">beforeAll</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">40</span><span>    process</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">env</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f8c555">NODE_ENV</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;production&#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">41</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">42</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">43</span><span>  </span><span class="token token" style="color:#f08d49">it</span><span class="token token" style="color:#ccc">(</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">throws an error if no keys are providerd</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">44</span><span>    </span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">throwsErr</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">45</span><span>      </span><span class="token token" style="color:#f08d49">read</span><span class="token token" style="color:#ccc">(</span><span>ssm</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">46</span><span>    </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">47</span><span>    </span><span class="token token" style="color:#f08d49">expect</span><span class="token token" style="color:#ccc">(</span><span>throwsErr</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">toThrowError</span><span class="token token" style="color:#ccc">(</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">You need to provide a non-empty array of config keys</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">48</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">49</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">50</span><span>  </span><span class="token token" style="color:#f08d49">it</span><span class="token token" style="color:#ccc">(</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">throws an error if some keys are missing</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">51</span><span>    </span><span class="token token" style="color:#f08d49">expect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">keys</span><span class="token token" style="color:#ccc">(</span><span>ssm</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;foobar&#x27;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">rejects</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">toEqual</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">Missing SSM Parameter Store keys: foobar</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">52</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">53</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">54</span><span>  </span><span class="token token" style="color:#f08d49">it</span><span class="token token" style="color:#ccc">(</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">throws an error when ssm is throwing one</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">55</span><span>    ssm </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">56</span><span>      </span><span class="token token function-variable" style="color:#f08d49">getParameters</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">57</span><span>        </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">58</span><span>          promise</span><span class="token token" style="color:#67cdcc">:</span><span> jest</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">fn</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">mockImplementation</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">request</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">59</span><span>            </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Promise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">resolve</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> reject</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">60</span><span>              </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#f08d49">reject</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;foobar&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">61</span><span>            </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token control-flow" style="color:#cc99cd">catch</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;Ok&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">62</span><span>          </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">63</span><span>        </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">64</span><span>      </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">65</span><span>    </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">66</span><span>    </span><span class="token token" style="color:#f08d49">expect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">keys</span><span class="token token" style="color:#ccc">(</span><span>ssm</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;foo&#x27;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">rejects</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">toEqual</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">TypeError: Cannot destructure property \`Parameters\` of &#x27;undefined&#x27; or &#x27;null&#x27;.</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">67</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">68</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span></span></code></pre><p>The <code>sreda</code> package is in the dev mode. Check it out if you would like to use
it in you serverless project: https://www.npmjs.com/package/sreda</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token" style="color:#f08d49">yarn</span><span> </span><span class="token token" style="color:#f08d49">add</span><span> sreda
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span><span></span><span class="token token" style="color:#f08d49">npm</span><span> i -S sreda</span></span></code></pre></article><footer class="jsx-1520861353 "><div class="jsx-2751559520 row c229"><div class="jsx-180329529 col "><a href="https://www.linkedin.com/in/igorkostyuchenok/" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"></path><circle cx="4" cy="4" r="2"></circle></svg></a><span class="jsx-225541363 "></span><a href="https://www.instagram.com/aplusplayer/" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37zM17.5 6.5h.01"></path></svg></a><span class="jsx-225541363 "></span><a href="https://github.com/igorkosta" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"></path></svg></a></div><span class="jsx-870436695 "></span><div class="jsx-180329529 col ">2021<!-- --> Â©costinha</div></div></footer></main><span class="jsx-3167743014"></span></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Mock promisified AWS service operation calls with Jest","content":"\nAt [Mbanq Cloud](https://mbanq.com/cloud) we run most of our services on AWS and try to use AWS Lambda as much as possible.\n\nA while ago Iâ€™ve been working on the a small npm package that should have helped us to make use of SSM and [KMS](https://aws.amazon.com/kms/) to manage our system configuration. SSM and KMS play nicely together as the most of the AWS services.\n\nIn order to test the newly written npm package, I had to mock the promisified version of the `ssm.getParameters(request)`\n\n```js\nconst AWS = require('aws-sdk')\nconst ssm = AWS.SSM({ region: 'eu-west-1 })\nssm.getParameters(request).promise() // we have to mock the response from this call\n```\n\nThere are different ways of mocking the AWS JS SDK calls. For example there is the [aws-mock-sdk](https://github.com/dwyl/aws-sdk-mock) package from the very cool [DWYL](https://dwyl.com/) guys. I decided to go with pure Jest implementation though.\n\n![](https://cdn-images-1.medium.com/max/2000/1*yZyG4rhfvTehkTsKtLxD9Q.png)\n\nThere are some things to be taken into account to make the SSMâ€™s functionality testable:\n\n- Use **ssm** as a parameter in your function call, e.g. const `load = (ssm, keys, expiryMs)` It will help you to use the mocked ssm whenever you write your tests. Sure you could also `module.exports = { ssm }` alongside other functions you want to export but I didnâ€™t really like this idea\n- If you wanna check for the errors thrown inside of an `async/await` function you have to use: `expect(yourFunc()).rejects.toEqual(new Error('Error Message'))` . The regular `expect(yourFunc()).toThrowError('Error Message')` [**WONâ€™T WORK](https://github.com/facebook/jest/issues/1700#issuecomment-377890222)**\n\nOk, now youâ€™re probably asking yourself:\n\u003e How the heck do you mock the promisified AWS service operation calls?\n\nYou will either want to mock a successful response from the `ssm.getParameters(request).promise()` or the `Error` thrown by the this function call.\n\n### Successful response\nFirst, create a js object with the promise key and mock the value of the promise with the `jest.fn().mockImplementation()` that will return a Promise that when resolved return a successful response.\n\nThen return the created `ssmPromise` whenever you make a call to `getParameters()` function.\n\n```js\nconst AWS = require('aws-sdk')\nlet ssm = new AWS.SSM()\nconst ssmPromise = {\n  promise: jest.fn().mockImplementation((request) =\u003e {\n    return new Promise((resolve, reject) =\u003e {\n      const response = {\n        Parameters: [\n          {\n            Name: 'bar',\n            Type: 'String',\n            Value: 'barfoorista',\n            Version: 1,\n            LastModifiedDate: '2018-08-22T13:49:55.717Z',\n            ARN: 'arn:aws:ssm:eu-west-1:whatever:parameter/bar'\n          },\n          {\n            Name: 'foo',\n            Type: 'String',\n            Value: 'foobarista',\n            Version: 1,\n            LastModifiedDate: '2018-08-22T13:49:41.486Z',\n            ARN: 'arn:aws:ssm:eu-west-1:whatever:parameter/foo'\n           }\n         ],\n         InvalidParameters: []\n       }\n       resolve(response)\n     })\n  })\n}\nssm = { getParameters: () =\u003e { return ssmPromise } }\n```\n\n### Throw an Error\n\nBy using the ssm instance you created at the top of your test, you can also mock the `ssm.getParameters()` in one go.\n\nHere is an example of how you could mock `ssm.getParameters()` throwing an Error\n\n```js\nssm = {\n  getParameters: () =\u003e {\n    return {\n      promise: jest.fn().mockImplementation((request) =\u003e {\n        return new Promise((resolve, reject) =\u003e {\n          return reject(new Error('foobar'))\n        }).catch(() =\u003e console.log('Ok'))\n      })\n    }\n  }\n}\n```\n\nIn a [gist](https://gist.github.com/igorkosta/6dae64ca2ababed7bec95255b2252842#file-sreda-test-js) (pun intended) you can see part of the test, weâ€™re using to test our package.\n\nHere is the content of the `gist` for you to check out:\n```js\n/* eslint-env jest */\n'use strict'\n\nconst { read, keys } = require('../sreda')\nconst AWS = require('aws-sdk')\nlet ssm = new AWS.SSM()\n\nvar ssmPromise = {\n  promise: jest.fn().mockImplementation((request) =\u003e {\n    return new Promise((resolve, reject) =\u003e {\n      const response = {\n        Parameters: [\n          {\n            Name: 'bar',\n            Type: 'String',\n            Value: 'barfoorista',\n            Version: 1,\n            LastModifiedDate: '2018-08-22T13:49:55.717Z',\n            ARN: 'arn:aws:ssm:eu-west-1:whatever:parameter/bar'\n          },\n          {\n            Name: 'foo',\n            Type: 'String',\n            Value: 'foobarista',\n            Version: 1,\n            LastModifiedDate: '2018-08-22T13:49:41.486Z',\n            ARN: 'arn:aws:ssm:eu-west-1:whatever:parameter/foo'\n          }\n        ],\n        InvalidParameters: []\n      }\n      resolve(response)\n    })\n  })\n}\nssm = { getParameters: () =\u003e { return ssmPromise } }\n\ndescribe('mock AWS.SSM()', () =\u003e {\n  beforeAll(async () =\u003e {\n    process.env.NODE_ENV = 'production'\n  })\n\n  it(`throws an error if no keys are providerd`, async () =\u003e {\n    function throwsErr () {\n      read(ssm, [])\n    }\n    expect(throwsErr).toThrowError(`You need to provide a non-empty array of config keys`)\n  })\n\n  it(`throws an error if some keys are missing`, async () =\u003e {\n    expect(keys(ssm, ['foobar'])).rejects.toEqual(new Error(`Missing SSM Parameter Store keys: foobar`))\n  })\n\n  it(`throws an error when ssm is throwing one`, async () =\u003e {\n    ssm = {\n      getParameters: () =\u003e {\n        return {\n          promise: jest.fn().mockImplementation((request) =\u003e {\n            return new Promise((resolve, reject) =\u003e {\n              return reject(new Error('foobar'))\n            }).catch(() =\u003e console.log('Ok'))\n          })\n        }\n      }\n    }\n    expect(keys(ssm, ['foo'])).rejects.toEqual(new Error(`TypeError: Cannot destructure property \\`Parameters\\` of 'undefined' or 'null'.`))\n  })\n})\n```\n\nThe `sreda` package is in the dev mode. Check it out if you would like to use\nit in you serverless project: https://www.npmjs.com/package/sreda\n\n```bash\nyarn add sreda\n\nnpm i -S sreda\n```\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"mock-promisified-aws-sdk-calls"},"buildId":"-a9J3t_46YDafVvRexG0-","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-af28de04c604a2479390.js"></script><script src="/_next/static/chunks/main-617444e650969530c471.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" async=""></script><script src="/_next/static/chunks/6d7639b8c21a1db6150380d8b11950c0467e4857.33b3de989fc02f1e1498.js" async=""></script><script src="/_next/static/chunks/e82d01500e11e0131e78851aa17fd9f5e63d6c88.4584f8b587d9150be7f6.js" async=""></script><script src="/_next/static/chunks/pages/_app-600fd752c0b787176940.js" async=""></script><script src="/_next/static/chunks/e763d8b2eb2e3ed4e3c29fd9fa38930b1c0c9253.d0a392dc3897215f8dc3.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-5e38c1a1efac4d425dfb.js" async=""></script><script src="/_next/static/-a9J3t_46YDafVvRexG0-/_buildManifest.js" async=""></script><script src="/_next/static/-a9J3t_46YDafVvRexG0-/_ssgManifest.js" async=""></script></body></html>