<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-0EWRL1QZ6D"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-0EWRL1QZ6D');
              </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>GraphQL Partial Update</title><meta name="description"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/7bf0f92461c52425edac.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7bf0f92461c52425edac.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-617444e650969530c471.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" as="script"/><link rel="preload" href="/_next/static/chunks/cbf05d6e2ab6b9f44494e6e3b824f3a371050466.a4a5ffea0dd00aeec4ee.js" as="script"/><link rel="preload" href="/_next/static/chunks/d352caca704d8ea168c0a61f40bd3955b4778157.4584f8b587d9150be7f6.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-1f657459a524fc55d23a.js" as="script"/><link rel="preload" href="/_next/static/chunks/e763d8b2eb2e3ed4e3c29fd9fa38930b1c0c9253.d05886f1d44c8774da0d.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-3077d5a95d172baf1eb1.js" as="script"/><style id="__jsx-2073500141">html,body{background-color:#fff;color:#000;}html{font-size:16px;--geist-icons-background:#fff;}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.5;margin:0;padding:0;min-height:100%;position:relative;overflow-x:hidden;font-family:"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;}#__next{overflow-x:hidden;}*,*:before,*:after{box-sizing:inherit;text-rendering:geometricPrecision;-webkit-tap-highlight-color:transparent;}p,small{font-weight:400;color:inherit;-webkit-letter-spacing:-0.005625rem;-moz-letter-spacing:-0.005625rem;-ms-letter-spacing:-0.005625rem;letter-spacing:-0.005625rem;font-family:"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;}p{margin:1rem 0;font-size:1em;line-height:1.625em;}small{margin:0;line-height:1.5;font-size:0.875rem;}b{font-weight:600;}span{font-size:inherit;color:inherit;font-weight:inherit;}img{max-width:100%;}a{cursor:pointer;font-size:inherit;-webkit-touch-callout:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-box-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#0070f3;-webkit-text-decoration:none;text-decoration:none;}a:hover{-webkit-text-decoration:none;text-decoration:none;}ul,ol{padding:0;list-style-type:none;margin:8pt 8pt 8pt 16pt;color:#000;}ol{list-style-type:decimal;}li{margin-bottom:0.625rem;font-size:1em;line-height:1.625em;}ul li:before{content:'â€“';display:inline-block;color:#888;position:absolute;margin-left:-0.9375rem;}h1,h2,h3,h4,h5,h6{color:inherit;margin:0 0 0.625rem 0;}h1{font-size:3rem;-webkit-letter-spacing:-0.066875rem;-moz-letter-spacing:-0.066875rem;-ms-letter-spacing:-0.066875rem;letter-spacing:-0.066875rem;line-height:1.5;font-weight:700;}h2{font-size:2.25rem;-webkit-letter-spacing:-0.020625rem;-moz-letter-spacing:-0.020625rem;-ms-letter-spacing:-0.020625rem;letter-spacing:-0.020625rem;font-weight:600;}h3{font-size:1.5rem;-webkit-letter-spacing:-0.029375rem;-moz-letter-spacing:-0.029375rem;-ms-letter-spacing:-0.029375rem;letter-spacing:-0.029375rem;font-weight:600;}h4{font-size:1.25rem;-webkit-letter-spacing:-0.020625rem;-moz-letter-spacing:-0.020625rem;-ms-letter-spacing:-0.020625rem;letter-spacing:-0.020625rem;font-weight:600;}h5{font-size:1rem;-webkit-letter-spacing:-0.01125rem;-moz-letter-spacing:-0.01125rem;-ms-letter-spacing:-0.01125rem;letter-spacing:-0.01125rem;font-weight:600;}h6{font-size:0.875rem;-webkit-letter-spacing:-0.005625rem;-moz-letter-spacing:-0.005625rem;-ms-letter-spacing:-0.005625rem;letter-spacing:-0.005625rem;font-weight:600;}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit;color:inherit;margin:0;}button:focus,input:focus,select:focus,textarea:focus{outline:none;}code{color:#f81ce5;font-family:Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;font-size:0.9em;white-space:pre-wrap;}code:before,code:after{content:'\`';}pre{border:1px solid #eaeaea;border-radius:5px;padding:calc(16pt * 0.75) 16pt;margin:16pt 0;font-family:Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;white-space:pre;overflow:auto;line-height:1.5;text-align:left;font-size:0.875rem;-webkit-overflow-scrolling:touch;}pre code{color:#000;font-size:0.8125rem;line-height:1.25rem;white-space:pre;}pre code:before,pre code:after{display:none;}pre p{margin:0;}pre::-webkit-scrollbar{display:none;width:0;height:0;background:transparent;}hr{border-color:#eaeaea;}details{background-color:#fafafa;border:none;}details:focus,details:hover,details:active{outline:none;}summary{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;list-style:none;outline:none;}summary::-webkit-details-marker,summary::before{display:none;}summary::-moz-list-bullet{font-size:0;}summary:focus,summary:hover,summary:active{outline:none;list-style:none;}blockquote{padding:calc(0.667 * 16pt) 16pt;color:#666;background-color:#fafafa;border-radius:5px;margin:1.5rem 0;border:1px solid #eaeaea;}blockquote *:first-child{margin-top:0;}blockquote *:last-child{margin-bottom:0;}::selection{background-color:#79ffe1;color:#000;}</style><style id="__jsx-1078679289">.btn.jsx-1078679289{box-sizing:border-box;display:inline-block;padding:0 1.25rem;height:2.5rem;line-height:2.5rem;min-width:min-content;width:auto;border-radius:5px;font-weight:400;font-size:.875rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;outline:none;text-transform:capitalize;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;text-align:center;white-space:nowrap;-webkit-transition:background-color 200ms ease 0ms,box-shadow 200ms ease 0ms, border 200ms ease 0ms,color 200ms ease 0ms;transition:background-color 200ms ease 0ms,box-shadow 200ms ease 0ms, border 200ms ease 0ms,color 200ms ease 0ms;position:relative;overflow:hidden;color:#666;background-color:transparent;border:1px solid transparent;cursor:pointer;pointer-events:auto;box-shadow:none;--geist-ui-button-padding:1.25rem;--geist-ui-button-height:2.5rem;--geist-ui-button-color:#666;--geist-ui-button-bg:transparent;}.btn.jsx-1078679289:hover,.btn.jsx-1078679289:focus{color:#666;--geist-ui-button-color:#666;background-color:transparent;border-color:transparent;cursor:pointer;pointer-events:auto;box-shadow:none;-webkit-transform:translate3d(0px,0px,0px);-ms-transform:translate3d(0px,0px,0px);transform:translate3d(0px,0px,0px);}.btn.jsx-1078679289 .text{position:relative;z-index:1;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;text-align:center;line-height:inherit;top:-1px;}.btn.jsx-1078679289 .text p,.btn.jsx-1078679289 .text pre,.btn.jsx-1078679289 .text div{margin:0;}</style><style id="__jsx-1583513589">.tabs.jsx-1583513589{width:initial;}header.jsx-1583513589{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid #eaeaea;overflow:scroll;-webkit-scrollbar-width:none;-moz-scrollbar-width:none;-ms-scrollbar-width:none;scrollbar-width:none;}header.jsx-1583513589::-webkit-scrollbar{display:none;}.hide-divider.jsx-1583513589{border-bottom:none;}.content.jsx-1583513589{padding-top:0.625rem;}.tab.jsx-1583513589{padding:4pt calc(0.65 * 4pt);cursor:pointer;outline:0;-webkit-transition:all 200ms ease;transition:all 200ms ease;text-transform:capitalize;font-size:1rem;white-space:nowrap;margin:0 calc(0.8 * 8pt);color:#444;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;line-height:1.25rem;position:relative;}.tab.jsx-1583513589:after{position:absolute;content:'';bottom:-1px;left:0;right:0;width:100%;height:2px;-webkit-transform:scaleX(0.75);-ms-transform:scaleX(0.75);transform:scaleX(0.75);background-color:transparent;-webkit-transition:all 200ms ease;transition:all 200ms ease;}.tab.active.jsx-1583513589:after{background-color:#000;-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);}.tab.jsx-1583513589 svg{max-height:1em;margin-right:5px;}.tab.jsx-1583513589:first-of-type{margin-left:0;}.tab.active.jsx-1583513589{color:#000;}.tab.disabled.jsx-1583513589{color:#999;cursor:not-allowed;}</style><style id="__jsx-3101351360">.link.jsx-3101351360{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;line-height:inherit;color:inherit;-webkit-text-decoration:none;text-decoration:none;padding:calc(0 * 0.8) calc(0 * 1.7);border-radius:0;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;-webkit-transition:color 200ms ease 0ms;transition:color 200ms ease 0ms;}.link.jsx-3101351360:hover,.link.jsx-3101351360:active,.link.jsx-3101351360:focus{-webkit-text-decoration:none;text-decoration:none;}.link.jsx-3101351360:hover{background-color:unset;color:inherit;}</style><style id="__jsx-225541363">span.jsx-225541363{display:inline-block;height:1px;width:1px;margin-left:calc(15.25pt + 1px * 0);margin-top:calc(15.25pt + 1px * 0);}</style><style id="__jsx-180329529">.col.jsx-180329529{float:left;box-sizing:border-box;padding-left:calc(var(--row-gap) / 2);padding-right:calc(var(--row-gap) / 2);width:100%;margin-left:0%;}</style><style id="__jsx-2751559520">.row.jsx-2751559520{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;box-sizing:border-box;margin-left:calc(0 * 16pt / 2);margin-right:calc(0 * 16pt / 2);--row-gap:calc(0 * 16pt);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:normal;-webkit-box-align:normal;-ms-flex-align:normal;align-items:normal;}</style><style id="__jsx-1520861353">footer.jsx-1520861353{width:calc(100% - 16pt * 2);position:absolute;bottom:0;}</style><style id="__jsx-3691154343">main.jsx-3691154343{width:100%;padding:calc(16pt * 2.5) 0;}</style><style id="__jsx-3167743014">body{background-image:radial-gradient(#e3e3e3 1px,transparent 0), radial-gradient(#e3e3e3 1px,transparent 0);background-position:0 0,25px 25px;background-attachment:fixed;background-size:50px 50px;}</style><style id="__jsx-2665439109">section.jsx-2665439109{width:calc(750pt - 100pt);max-width:100vw;min-height:100vh;margin:0 auto;padding:0 16pt;box-sizing:border-box;position:relative;}</style></head><body><div id="__next"><div class="header-0-2-49"><div class="headerContent-0-2-50"><div class="headerTitle-0-2-51">Costinha</div><div><button type="button" aria-label="Toggle Dark mode" class="jsx-1078679289 btn themeIcon-0-2-55"><div class="text"><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="16" width="16" style="color:currentColor"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg></div></button></div></div></div><nav class="nav-0-2-52 "><div class="navContent-0-2-54"><div class="jsx-1583513589 tabs "><header class="jsx-1583513589 "></header><div class="jsx-1583513589 content"></div></div></div></nav><main><section class="jsx-2665439109 "><main class="jsx-3691154343 "><article><h3>GraphQL Partial Update</h3><p>Recently we decided to use <a href="https://aws.amazon.com/amplify">AWS Amplify</a> for one of the products weâ€™re currently working on.</p><p><a href="https://aws.amazon.com/amplify">AWS Amplify</a> promises to provide you with the option to rapidly develop the <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> or a <a href="https://graphql.org/">GraphQL</a> based backend that&#x27;s very well integrated with your frontend development - be it a web application or a mobile app. That&#x27;s at least the marketed value proposition.</p><p>I don&#x27;t wanna say that&#x27;s <a href="https://aws.amazon.com/amplify">AWS Amplify</a> is still in its infancy but let&#x27;s say it&#x27;s
not without its caveats. One of them is the documentation. In general AWS
provides a lot of documentation, which doesn&#x27;t necessarily means that it&#x27;s
good.</p><p>Usually the truly technical documentation like the one for AWS SDK is really
good, which is not always the case with the Docs for other services. With AWS
Amplify it&#x27;s pretty often the case that the documentation is not up-to-date and
you have to dig through the GitHub tickets discussions to find the truth or
the undocumented features (yes, <code>@http resolvers</code> - I look at you)</p><p>If you have to provide custom headers to your HTTP resolver based GraphQL
operation - you can send them as part of <code>API.graphql()</code> call as last
parameter, e.g.</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token" style="color:#cc99cd">const</span><span> headers </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span>  foor</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;bar&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">4</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">5</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f8c555">API</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">graphql</span><span class="token token" style="color:#ccc">(</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">6</span><span>  </span><span class="token token" style="color:#f08d49">graphqlOperation</span><span class="token token" style="color:#ccc">(</span><span>createFooBar</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span> body </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">7</span><span>  headers</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">8</span><span></span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></span></code></pre><p>But I&#x27;m drifting away ðŸ˜€</p><p>Ok, so, we decided to go with GraphQL since in the final iterations the product should have more than just a web application and, theoretically, it should be easier to fetch only the data you need due to the flexible nature of <a href="https://graphql.org/">GraphQL</a>.</p><p>So, if you worked with <a href="https://aws.amazon.com/amplify/">AWS Amplify</a> and <a href="https://graphql.org/">GraphQL</a> you know that it doesnâ€™t support partial updates, which was a deal-breaker for us, since we have multiple flows where we have to partially push the data to the backend.</p><p>After a short research online, I found a pretty cool article from <a href="https://medium.com/@arnaud.bezancon">Arnaud BezanÃ§on</a> here <a href="https://medium.com/workflowgen/graphql-mutations-partial-updates-implementation-bff586bda989">https://medium.com/workflowgen/graphql-mutations-partial-updates-implementation-bff586bda989</a></p><p>Although I really liked his way of doing things, my lazy nature wanted to have a more generic (not necessarily a better) solution though. So, my way of thinking was: since I only send parts of the data to the backend but it expects the whole { input } object from me, I will just merge the existing data with the new one and push it to the backend.</p><p>What you have to consider as well is that you will have to remove any automatically generated/updated fields from your <code>json</code> object â€” in my case <code>createdAt/updatedAt</code> fields.</p><p>So, below you see a quick and dirty way of doing it.</p><p>Please, note that Iâ€™m using email as the key of our user model. In addition to that, you will have to always send the whole user object with all the fields to the update mutation â€” meaning when you call <code>getUser</code> it should fetch the user object with all the fields.</p><p>In a nutshell - the flow is the following:</p><ul><li>try to fetch the user from the backend</li><li>if the user doesn&#x27;t exist - call <code>createUser</code> with the provided data</li><li>if the user exist - merge the existing data with the new one and call
<code>updateUser</code></li></ul><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token" style="color:#f8c555">API</span><span class="token token" style="color:#ccc">,</span><span> graphqlOperation </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;aws-amplify&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> getUser </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@/graphql/queries&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> createUser</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> updateUser </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@/graphql/mutations&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">4</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> exclude </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@/utils/json&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">5</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">6</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">get</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">email</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">7</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">try</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">8</span><span>    </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">9</span><span>      data</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">10</span><span>        getUser</span><span class="token token" style="color:#67cdcc">:</span><span> user</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">11</span><span>      </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">12</span><span>    </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f8c555">API</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">graphql</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">graphqlOperation</span><span class="token token" style="color:#ccc">(</span><span>getUser</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span> email </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">13</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> user</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">14</span><span>  </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token control-flow" style="color:#cc99cd">catch</span><span> </span><span class="token token" style="color:#ccc">(</span><span>error</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">15</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">throw</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span>error</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">errors</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">16</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">17</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">18</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">19</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">createOrUpdate</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">input</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">20</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span> email </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> input</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">21</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">try</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">22</span><span>    </span><span class="token token" style="color:#cc99cd">const</span><span> user </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f08d49">get</span><span class="token token" style="color:#ccc">(</span><span>email</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">23</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#67cdcc">!</span><span>user</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">24</span><span>      </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f8c555">API</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">graphql</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">graphqlOperation</span><span class="token token" style="color:#ccc">(</span><span>createUser</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span> input </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">25</span><span>    </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token control-flow" style="color:#cc99cd">else</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">26</span><span>      </span><span class="token token" style="color:#999">// get current user data</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">27</span><span>      </span><span class="token token" style="color:#999">// and only update the provided values</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">28</span><span>      </span><span class="token token" style="color:#999">// createdAt, updatedAt have to be excluded</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">29</span><span>      </span><span class="token token" style="color:#cc99cd">const</span><span> update </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token spread" style="color:#67cdcc">...</span><span class="token token method property-access" style="color:#f08d49">exclude</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;createdAt&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;updatedAt&#x27;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">,</span><span> user</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token spread" style="color:#67cdcc">...</span><span>input </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">30</span><span>      </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f8c555">API</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">graphql</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">graphqlOperation</span><span class="token token" style="color:#ccc">(</span><span>updateUser</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span> input</span><span class="token token" style="color:#67cdcc">:</span><span> update </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">31</span><span>    </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">32</span><span>  </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token control-flow" style="color:#cc99cd">catch</span><span> </span><span class="token token" style="color:#ccc">(</span><span>error</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">33</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">throw</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span>error</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">errors</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">34</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">35</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">36</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">37</span><span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token exports" style="color:#ccc">{</span><span class="token token exports">
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">38</span><span class="token token exports">  get</span><span class="token token exports" style="color:#ccc">,</span><span class="token token exports">
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">39</span><span class="token token exports">  createOrUpdate</span><span class="token token exports" style="color:#ccc">,</span><span class="token token exports">
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#999">40</span><span class="token token exports"></span><span class="token token exports" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span></span></code></pre><p>Since the email is used as the key of the user model, it has to be passed to the <code>createOrUpdate</code> function as part of the <code>{ input }</code> object. Whenever I have to create or update a user, we have to add the email to the input and then just call <code>createOrUpdate(input);</code></p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">1</span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span> email </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> user</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">2</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> input </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span> email</span><span class="token token" style="color:#ccc">,</span><span> â€¦payload </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">3</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">4</span><span></span><span class="token token control-flow" style="color:#cc99cd">try</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">5</span><span>  </span><span class="token token spread" style="color:#67cdcc">...</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">6</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f08d49">createOrUpdate</span><span class="token token" style="color:#ccc">(</span><span>input</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">7</span><span>  </span><span class="token token spread" style="color:#67cdcc">...</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">8</span><span></span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token control-flow" style="color:#cc99cd">catch</span><span> </span><span class="token token" style="color:#ccc">(</span><span>error</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">9</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">throw</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Error</span><span class="token token" style="color:#ccc">(</span><span>error</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#999">10</span><span></span><span class="token token" style="color:#ccc">}</span></span></code></pre><p>Itâ€™s not an efficient way of doing things since it will fetch the data from your backend before doing an update but this way you donâ€™t have to do things manually or thing about the values youâ€™d like to be updated.</p><p>Thatâ€™s all folks.</p></article><footer class="jsx-1520861353 "><div class="jsx-2751559520 row footer-0-2-56"><div class="jsx-180329529 col "><a href="https://www.linkedin.com/in/igorkostyuchenok/" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"></path><circle cx="4" cy="4" r="2"></circle></svg></a><span class="jsx-225541363 "></span><a href="https://www.instagram.com/aplusplayer/" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37zM17.5 6.5h.01"></path></svg></a><span class="jsx-225541363 "></span><a href="https://github.com/igorkosta" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"></path></svg></a><span class="jsx-225541363 "></span><a href="mailto:igor.kostyuchenok@gmail.com" target="_blank" class="jsx-3101351360 link "><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" style="color:currentColor"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><path d="M22 6l-10 7L2 6"></path></svg></a></div></div></footer></main><span class="jsx-3167743014"></span></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"GraphQL Partial Update","content":"\nRecently we decided to use [AWS Amplify](https://aws.amazon.com/amplify) for one of the products weâ€™re currently working on.\n\n[AWS Amplify](https://aws.amazon.com/amplify) promises to provide you with the option to rapidly develop the [REST](https://en.wikipedia.org/wiki/Representational_state_transfer) or a [GraphQL](https://graphql.org/) based backend that's very well integrated with your frontend development - be it a web application or a mobile app. That's at least the marketed value proposition.\n\nI don't wanna say that's [AWS Amplify](https://aws.amazon.com/amplify) is still in its infancy but let's say it's\nnot without its caveats. One of them is the documentation. In general AWS\nprovides a lot of documentation, which doesn't necessarily means that it's\ngood.\n\nUsually the truly technical documentation like the one for AWS SDK is really\ngood, which is not always the case with the Docs for other services. With AWS\nAmplify it's pretty often the case that the documentation is not up-to-date and\nyou have to dig through the GitHub tickets discussions to find the truth or\nthe undocumented features (yes, `@http resolvers` - I look at you)\n\nIf you have to provide custom headers to your HTTP resolver based GraphQL\noperation - you can send them as part of `API.graphql()` call as last\nparameter, e.g.\n\n```js\nconst headers = {\n  foor: 'bar',\n};\n\nconst response = await API.graphql(\n  graphqlOperation(createFooBar, { body }),\n  headers,\n);\n```\n\nBut I'm drifting away ðŸ˜€\n\nOk, so, we decided to go with GraphQL since in the final iterations the product should have more than just a web application and, theoretically, it should be easier to fetch only the data you need due to the flexible nature of [GraphQL](https://graphql.org/).\n\nSo, if you worked with [AWS Amplify](https://aws.amazon.com/amplify/) and [GraphQL](https://graphql.org/) you know that it doesnâ€™t support partial updates, which was a deal-breaker for us, since we have multiple flows where we have to partially push the data to the backend.\n\nAfter a short research online, I found a pretty cool article from [Arnaud BezanÃ§on](https://medium.com/@arnaud.bezancon) here [https://medium.com/workflowgen/graphql-mutations-partial-updates-implementation-bff586bda989](https://medium.com/workflowgen/graphql-mutations-partial-updates-implementation-bff586bda989)\n\nAlthough I really liked his way of doing things, my lazy nature wanted to have a more generic (not necessarily a better) solution though. So, my way of thinking was: since I only send parts of the data to the backend but it expects the whole { input } object from me, I will just merge the existing data with the new one and push it to the backend.\n\nWhat you have to consider as well is that you will have to remove any automatically generated/updated fields from your `json` object â€” in my case `createdAt/updatedAt` fields.\n\nSo, below you see a quick and dirty way of doing it.\n\nPlease, note that Iâ€™m using email as the key of our user model. In addition to that, you will have to always send the whole user object with all the fields to the update mutation â€” meaning when you call `getUser` it should fetch the user object with all the fields.\n\nIn a nutshell - the flow is the following:\n- try to fetch the user from the backend\n- if the user doesn't exist - call `createUser` with the provided data\n- if the user exist - merge the existing data with the new one and call\n  `updateUser`\n\n```js\nimport { API, graphqlOperation } from 'aws-amplify';\nimport { getUser } from '@/graphql/queries';\nimport { createUser, updateUser } from '@/graphql/mutations';\nimport { exclude } from '@/utils/json';\n\nconst get = async (email) =\u003e {\n  try {\n    const {\n      data: {\n        getUser: user,\n      },\n    } = await API.graphql(graphqlOperation(getUser, { email }));\n    return user;\n  } catch (error) {\n    throw new Error(error.errors);\n  }\n};\n\nconst createOrUpdate = async (input) =\u003e {\n  const { email } = input;\n  try {\n    const user = await get(email);\n    if (!user) {\n      await API.graphql(graphqlOperation(createUser, { input }));\n    } else {\n      // get current user data\n      // and only update the provided values\n      // createdAt, updatedAt have to be excluded\n      const update = { ...exclude(['createdAt', 'updatedAt'], user), ...input };\n      await API.graphql(graphqlOperation(updateUser, { input: update }));\n    }\n  } catch (error) {\n    throw new Error(error.errors);\n  }\n};\n\nexport {\n  get,\n  createOrUpdate,\n};\n```\n\nSince the email is used as the key of the user model, it has to be passed to the `createOrUpdate` function as part of the `{ input }` object. Whenever I have to create or update a user, we have to add the email to the input and then just call `createOrUpdate(input);`\n\n```js\nconst { email } = user;\nconst input = { email, â€¦payload };\n\ntry {\n  ...\n  await createOrUpdate(input);\n  ...\n} catch (error) {\n  throw new Error(error);\n}\n```\n\nItâ€™s not an efficient way of doing things since it will fetch the data from your backend before doing an update but this way you donâ€™t have to do things manually or thing about the values youâ€™d like to be updated.\n\nThatâ€™s all folks.\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"graphql-partial-update"},"buildId":"OMIOeWKxopmf6yRC9hUgf","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-feb8a7604fa7fce626b2.js"></script><script src="/_next/static/chunks/main-617444e650969530c471.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" async=""></script><script src="/_next/static/chunks/cbf05d6e2ab6b9f44494e6e3b824f3a371050466.a4a5ffea0dd00aeec4ee.js" async=""></script><script src="/_next/static/chunks/d352caca704d8ea168c0a61f40bd3955b4778157.4584f8b587d9150be7f6.js" async=""></script><script src="/_next/static/chunks/pages/_app-1f657459a524fc55d23a.js" async=""></script><script src="/_next/static/chunks/e763d8b2eb2e3ed4e3c29fd9fa38930b1c0c9253.d05886f1d44c8774da0d.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-3077d5a95d172baf1eb1.js" async=""></script><script src="/_next/static/OMIOeWKxopmf6yRC9hUgf/_buildManifest.js" async=""></script><script src="/_next/static/OMIOeWKxopmf6yRC9hUgf/_ssgManifest.js" async=""></script></body></html>